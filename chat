@model WebApplication1.Controllers.PolicyRequestViewModel

@{
    ViewData["Title"] = "Review Policy Request";
}

<h2>Review Policy Request</h2>

<!-- Display Policy Details -->
<div class="card">
    <div class="card-header">
        Policy Details
    </div>
    <div class="card-body">
        <h5 class="card-title">Insured Policy ID: @Model.InsuredPolicyId</h5>
        <p class="card-text">
            <strong>Insured ID:</strong> @Model.InsuredId <br />
            <strong>Policy ID:</strong> @Model.PolicyId <br />
            <strong>Policy Holder ID:</strong> @Model.PolicyHolderId <br />
            <strong>Name:</strong> @Model.Name <br />
            <strong>Current Approval Status:</strong> @Model.ApprovalStatus <br />
            <strong>Approval Date:</strong> @Model.ApprovalDate?.ToString("yyyy-MM-dd HH:mm:ss")
        </p>
    </div>
    <div class="card-footer text-muted">
        <!-- Buttons for Approval and Rejection -->
        <button class="btn btn-success" onclick="updateApprovalStatus(@Model.InsuredPolicyId, 'Approved')">Approve</button>
        <button class="btn btn-danger" onclick="updateApprovalStatus(@Model.InsuredPolicyId, 'Rejected')">Reject</button>
        <a href="@Url.Action("Index", "PolicyRequest")" class="btn btn-secondary">Back to List</a>
    </div>
</div>

@section Scripts {
    <script>
        function updateApprovalStatus(insuredPolicyId, status) {
            $.post('@Url.Action("UpdateApprovalStatus", "PolicyRequest")', { insuredPolicyId: insuredPolicyId, approvalStatus: status })
                .done(function () {
                    alert('Approval status updated successfully.');
                    window.location.href = '@Url.Action("Index", "PolicyRequest")';
                })
                .fail(function () {
                    alert('Failed to update approval status.');
                });
        }
    </script>
}
